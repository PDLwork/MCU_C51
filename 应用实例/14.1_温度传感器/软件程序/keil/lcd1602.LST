C51 COMPILER V9.01   LCD1602                                                               05/08/2021 18:31:42 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN lcd1602.OBJ
COMPILER INVOKED BY: D:\软件\keil\C51\BIN\C51.EXE lcd1602.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg51.h>
   2          
   3          #include"userdef.h"
   4          #include"lcd1602.h"
   5          #include"ds18b20.h"
   6          
   7          uchar data disdata[4];    //用于存放显示数字数组
   8          
   9          static void delay1ms(uint x)  /*延时1毫秒函数*/
  10          { 
  11   1          uint i,j;
  12   1          for(i=0;i<x;i++)
  13   1              for(j=0;j<100;j++);
  14   1      }
  15          
  16          extern void lcd_write_com(uchar com)   /*LCD写命令函数*/
  17          { 
  18   1           delay1ms(1);
  19   1           LCD_RS = 0;
  20   1           LCD_RW = 0;
  21   1           LCD_E = 0;
  22   1           P0 = com;
  23   1           delay1ms(1);
  24   1           LCD_E = 1;
  25   1           delay1ms(1);
  26   1           LCD_E = 0;
  27   1      }
  28          
  29          static void lcd_write_dat(uchar dat)   /*LCD写数据函数*/
  30          { 
  31   1           delay1ms(1);;
  32   1           LCD_RS = 1;
  33   1           LCD_RW = 0;
  34   1           LCD_E = 0;
  35   1           P0 = dat;
  36   1           delay1ms(1);
  37   1           LCD_E = 1;
  38   1           delay1ms(1);
  39   1           LCD_E = 0;
  40   1      }
  41          
  42          extern void lcd_init()         /*LCD初始化设置*/
  43          {
  44   1          lcd_write_com(0x01);           //清屏
  45   1          delay1ms(1);
  46   1          lcd_write_com(0x38);           //设置显示两行、每个字符为5*7点阵、数据线为8根
  47   1              delay1ms(1);
  48   1              lcd_write_com(0x06);       //输入后地址指针右移
  49   1              delay1ms(1);
  50   1      }
  51          
  52          extern void lcd_dis_mod(uchar x)           /*显示方式设置，1为实时显示，2为设置模式*/
  53          {
  54   1              if(x==1)
  55   1              {
C51 COMPILER V9.01   LCD1602                                                               05/08/2021 18:31:42 PAGE 2   

  56   2                      lcd_write_com(0x0c);       //显示打开、光标关闭
  57   2                      delay1ms(1);
  58   2      
  59   2                      lcd_write_com(0x80);
  60   2                  lcd_write_dat('A');
  61   2                  lcd_write_dat(':');
  62   2                  lcd_write_com(0x8A);
  63   2                  lcd_write_dat(0xdf);            //显示摄氏温度字符°
  64   2                  lcd_write_dat('C');
  65   2              
  66   2                  lcd_write_com(0xc0);
  67   2                  lcd_write_dat('B');
  68   2                  lcd_write_dat(':');
  69   2                  lcd_write_com(0xcA);
  70   2                  lcd_write_dat(0xdf);        //显示摄氏温度字符°
  71   2                  lcd_write_dat('C');
  72   2              }
  73   1              if(x==2)
  74   1              {       
  75   2                      lcd_write_com(0x0f);       //显示打开、光标打开并闪烁
  76   2                      delay1ms(1);
  77   2      
  78   2                      lcd_write_com(0x80);
  79   2                  lcd_write_dat('H');
  80   2                  lcd_write_dat(':');
  81   2                      lcd_write_com(0x86);
  82   2                      lcd_write_dat(0xdf);        //显示摄氏温度字符°
  83   2                  lcd_write_dat('C');
  84   2                      
  85   2                      lcd_write_com(0xc0);
  86   2                  lcd_write_dat('L');
  87   2                  lcd_write_dat(':');
  88   2                      lcd_write_com(0xc6);
  89   2                      lcd_write_dat(0xdf);        //显示摄氏温度字符°
  90   2                  lcd_write_dat('C'); 
  91   2              }
  92   1      }
  93          
  94          extern void lcd_disp_alarm(char xx)    /*报警设置显示函数*/
  95          {
  96   1              uchar flagdat;  
  97   1              if(xx>=0)
  98   1              {
  99   2                      flagdat=0x20;//正温度不显示符号
 100   2              }
 101   1              else
 102   1              {
 103   2                      flagdat=0x2d;//负温度显示负号:-
 104   2                      xx = xx * -1;
 105   2              }
 106   1      
 107   1              disdata[0]=xx/100+0x30;//百位数
 108   1              disdata[1]=xx/10%10+0x30;//十位数
 109   1              disdata[2]=xx%10+0x30;//个位数
 110   1                              
 111   1              if(disdata[0]==0x30)
 112   1              {
 113   2                      disdata[0]=0x20;//如果百位为0，不显示
 114   2              if(disdata[1]==0x30)
 115   2                      {
 116   3                              disdata[1]=0x20;//如果百位为0，十位为0也不显示
 117   3                      }
C51 COMPILER V9.01   LCD1602                                                               05/08/2021 18:31:42 PAGE 3   

 118   2              }
 119   1          lcd_write_dat(flagdat);//显示符号位
 120   1          lcd_write_dat(disdata[0]);//显示百位
 121   1          lcd_write_dat(disdata[1]);//显示十位 
 122   1          lcd_write_dat(disdata[2]);//显示个位
 123   1      }
 124          
 125          extern void lcd_disp_18b20(uchar x)    /*温度值显示函数*/
 126          {    
 127   1              uchar flagdat;
 128   1              disdata[0]=tvalue/10000+0x30;//百位数
 129   1              disdata[1]=tvalue%10000/1000+0x30;//十位数
 130   1              disdata[2]=tvalue%1000/100+0x30;//个位数
 131   1              disdata[3]=tvalue%100/10+0x30;//小数点后一位
 132   1              disdata[4]=tvalue%10+0x30;//小数点后两位
 133   1              
 134   1              if(tflag==0)
 135   1                      flagdat=0x20;//正温度不显示符号
 136   1              else
 137   1                      flagdat=0x2d;//负温度显示负号:-
 138   1      
 139   1              if(disdata[0]==0x30)
 140   1              {
 141   2                      disdata[0]=0x20;//如果百位为0，不显示
 142   2              if(disdata[1]==0x30)
 143   2                      {
 144   3                              disdata[1]=0x20;//如果百位为0，十位为0也不显示
 145   3                      }
 146   2              }
 147   1      
 148   1          if(x==1)
 149   1          {
 150   2                      lcd_write_com(0x82);    //显示地址位置
 151   2              }
 152   1              if(x==2)
 153   1              {
 154   2                      lcd_write_com(0xc2);
 155   2              }
 156   1          lcd_write_dat(flagdat);//显示符号位
 157   1          lcd_write_dat(disdata[0]);//显示百位
 158   1          lcd_write_dat(disdata[1]);//显示十位 
 159   1          lcd_write_dat(disdata[2]);//显示个位 
 160   1          lcd_write_dat(0x2e);//显示小数点 
 161   1              lcd_write_dat(disdata[3]);//显示小数点后一位
 162   1              lcd_write_dat(disdata[4]);//显示小数点后两位    
 163   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    537    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
